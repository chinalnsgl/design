<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="include :: header"></head>
<body class="hold-transition login-page"  th:style="|background-image: url(@{/img/bglogin.jpg}); background-repeat: no-repeat;background-size: cover;background-attachment: fixed;|">
<div class="login-box">
  <div class="login-logo">
    <b style="color: white;">技术研发部看板系统</b>
  </div>
  <!-- /.login-logo -->
  <div class="login-box-body">
    <p class="login-box-msg">登录</p>

    <form id="userForm">
      <div class="form-group has-feedback">
        <input type="text" class="form-control" name="userName" placeholder="请输入用户名">
        <span class="glyphicon glyphicon-envelope form-control-feedback"></span>
      </div>
      <div class="form-group has-feedback">
        <input type="password" name="password" class="form-control" placeholder="请输入密码">
        <span class="glyphicon glyphicon-lock form-control-feedback"></span>
      </div>
      <div class="row">
        <!-- /.col -->
        <div class="col-xs-12">
          <button id="btn_commit" type="button" class="btn btn-primary btn-block btn-flat">登录</button>
        </div>
        <!-- /.col -->
      </div>
    </form>
  </div>
  <!-- /.login-box-body -->
</div>
<!-- /.login-box -->
<div th:include="include :: footer"></div>

<script th:inline="javascript">

  window.onload = function () {
    if (window.parent.window != window) {
      window.top.location = "/";
    }
  };

  var userForm = $("#userForm");

  /** 表单验证设置 */
  function setValid() {
    userForm.bootstrapValidator({
      feedbackIcons: {
        valid: 'glyphicon glyphicon-ok',
        invalid: 'glyphicon glyphicon-remove',
        validating: 'glyphicon glyphicon-refresh'
      },
      fields: {
        userName: {
          validators: {
            notEmpty: {message: '请输入帐号'}
          }
        },
        password: {validators: {notEmpty: {message: '请输入密码'}}},
      }
    });
  }

  /** 创建项目事件 */
  function createEvent() {
    $("#btn_commit").click(function () {
      userForm.bootstrapValidator('validate');//提交验证
      if (userForm.data('bootstrapValidator').isValid()) {//获取验证结果，如果成功，执行下面代码
        $.ajax({
          url: "/login",
          type:"POST",
          data: userForm.serialize(),
          success: function(result){
            if (result.status === 200) {
              location.href = "/index";
            } else {
              toastr.error("帐号密码错误！");
            }
          },
          error: function() {
            toastr.error("系统错误，登录失败！");
          }
        });
      }
    });
  }

  $(function () {
    setValid();
    createEvent();
    $('input').iCheck({
      checkboxClass: 'icheckbox_square-blue',
      radioClass: 'iradio_square-blue',
      increaseArea: '20%' /* optional */
    });
  });
</script>
</body>
</html>
