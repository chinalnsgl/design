<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head th:include="include :: header"></head>
<body class="hold-transition skin-blue sidebar-mini">
<!--任务进度模态框-->
<div class="modal fade" id="modal-task">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">编辑任务进度</h4>
      </div>
      <div class="modal-body">

        <form id="taskForm" class="form-horizontal" role="form">
          <input type="hidden" name="id" id="id">
          <input type="hidden" name="status" id="status">

          <div class="form-group">
            <label for="principal" class="col-sm-2 control-label no-padding-right">项目</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="projectName" disabled>
            </div>
          </div>
          <div class="form-group">
            <label for="principal" class="col-sm-2 control-label no-padding-right">任务</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="stepName" disabled>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label no-padding-right">状态</label>
            <div class="col-sm-10">
              <span id="successStatus">已完成</span>
              <button type="button" class="btn btn-info" id="btn-commit">开始</button>
              <button type="button" class="btn btn-info" id="btn-commit-produce">开始</button>
              <button shiro:hasPermission="dept:cancel" type="button" class="btn btn-info" id="btn-cancel">撤消</button>
              <button shiro:hasPermission="sign:cancel" type="button" class="btn btn-info btn-cancel-task" id="btn-cancel-sign">撤消</button>
              <button shiro:hasPermission="contract:cancel" type="button" class="btn btn-info btn-cancel-task" id="btn-cancel-contract">撤消</button>
              <button shiro:hasPermission="process1:cancel" type="button" class="btn btn-info btn-cancel-task" id="btn-cancel-process1">撤消</button>
              <button shiro:hasPermission="process2:cancel" type="button" class="btn btn-info btn-cancel-task" id="btn-cancel-process2">撤消</button>
              <button shiro:hasPermission="process3:cancel" type="button" class="btn btn-info btn-cancel-task" id="btn-cancel-process3">撤消</button>
              <button shiro:hasPermission="produce1:cancel" type="button" class="btn btn-info btn-cancel-task" id="btn-cancel-produce1">撤消</button>
              <button shiro:hasPermission="produce2:cancel" type="button" class="btn btn-info btn-cancel-task" id="btn-cancel-produce2">撤消</button>
              <button shiro:hasPermission="produce3:cancel" type="button" class="btn btn-info btn-cancel-task" id="btn-cancel-produce3">撤消</button>
              <button shiro:hasPermission="debug:cancel" type="button" class="btn btn-info btn-cancel-task" id="btn-cancel-debug">撤消</button>
              <button shiro:hasPermission="accept:cancel" type="button" class="btn btn-info btn-cancel-task" id="btn-cancel-accept">撤消</button>
              <button shiro:hasPermission="save:cancel" type="button" class="btn btn-info btn-cancel-task" id="btn-cancel-save">撤消</button>
            </div>
          </div>
          <div class="form-group">
            <label for="principal" class="col-sm-2 control-label no-padding-right">负责人</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="principal" name="principal" placeholder="请输入负责人" >
            </div>
          </div>
          <div class="form-group" id="contractDiv">
            <label for="contractNo" class="col-sm-2 control-label no-padding-right">合同号</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="contractNo" name="contractNo" placeholder="请输入合同号" >
            </div>
          </div>
          <div class="form-group" id="planStartTimeDiv">
            <label for="planStartTime" class="col-sm-2 control-label no-padding-right">预计时间</label>
            <div class="col-sm-10">
              <input type="text" class="form-control datepicker" id="planStartTime" name="planStartTime" readonly >
            </div>
          </div>
          <div class="form-group">
            <label for="comment" class="col-sm-2 control-label no-padding-right">备注</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="comment" name="comment" placeholder="请输入备注" >
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-info" id="btn-comment">确定</button>
        <button type="button" class="btn btn-info" id="btn-comment-produce">确定</button>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!--文件上传下载模态框-->
<div class="modal fade" id="modal-upload">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">上传文件</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-offset-1">
            <form id="uploadForm" th:action="@{/project/upload}" method="post" class="form-horizontal" role="form" enctype="multipart/form-data">
              <input type="hidden" name="id" id="upload_id">
              <input type="hidden" name="code" id="upload_code">
              <input type="hidden" name="type" id="upload_type">
              <div class="form-group"  shiro:hasPermission="task:download" id="taskGroup">
                <div class="row" th:each="image: ${project.images}" th:if="${image.type == 1}">
                    <input style="margin-left: 20px" type="checkbox" name="ids" th:value="${image.id}" >
                    <label style="margin-left: 10px" th:text="${image.name}">项目</label>
                </div>
              </div>
              <div class="form-group" shiro:hasPermission="sign:download" id="signGroup">
                <div class="row" th:each="image: ${project.images}" th:if="${image.type == 2}">
                  <input style="margin-left: 20px" type="checkbox" name="ids" th:value="${image.id}" >
                  <label style="margin-left: 10px" th:text="${image.name}">项目</label>
                </div>
              </div>
              <div class="form-group" id="contractGroup" shiro:hasPermission="contract:download" >
                <div class="row" th:each="image: ${project.images}" th:if="${image.type == 3}">
                  <input style="margin-left: 20px" type="checkbox" name="ids" th:value="${image.id}" >
                  <label style="margin-left: 10px" th:text="${image.name}">项目</label>
                </div>
              </div>
              <div class="form-group">
                <label for="upload_file">上传文件</label>
                <input type="file" multiple="multiple" id="upload_file" name="file">
                <p class="help-block">请选择所需要上传的文件</p>
              </div>
            </form>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button shiro:hasPermission="task:upload" type="button" class="btn btn-info upload-btn" id="btn-task-upload">上传</button>
        <a href="" shiro:hasPermission="task:download" class="btn btn-success down-btn" id="btn-task-download">下载</a>
        <button shiro:hasPermission="task:del" type="button" class="btn btn-danger remove-btn" id="btn-task-del">删除</button>
        <button shiro:hasPermission="sign:upload" type="button" class="btn btn-info upload-btn" id="btn-sign-upload">上传</button>
        <a href="" shiro:hasPermission="sign:download" class="btn btn-success down-btn" id="btn-sign-download">下载</a>
        <button shiro:hasPermission="sign:del" type="button" class="btn btn-danger remove-btn" id="btn-sign-del">删除</button>
        <button shiro:hasPermission="contract:upload" type="button" class="btn btn-info upload-btn" id="btn-contract-upload">上传</button>
        <a href="" shiro:hasPermission="contract:download" class="btn btn-success down-btn" id="btn-contract-download">下载</a>
        <button shiro:hasPermission="contract:del" type="button" class="btn btn-danger remove-btn" id="btn-contract-del">删除</button>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!--任务信息模态框-->
<div class="modal fade" id="modal-info">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">查看信息</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <label for="info_projectName" class="col-sm-2 no-padding-right">项目</label>
          <div class="col-sm-10 center-info" id="info_projectName"></div>
        </div>
        <div class="row">
          <label for="info_task" class="col-sm-2 no-padding-right">任务</label>
          <div class="col-sm-10 center-info" id="info_task"></div>
        </div>
        <div class="row" id="contractInfoDiv">
          <label for="info_contract" class="col-sm-2 no-padding-right">合同号</label>
          <div class="col-sm-10 center-info" id="info_contract"></div>
        </div>
        <div class="row">
          <label for="info_status" class="col-sm-2 no-padding-right">状态</label>
          <div class="col-sm-10 center-info" id="info_status"></div>
        </div>
        <div class="row">
          <label for="info_principal" class="col-sm-2 no-padding-right">负责人</label>
          <div class="col-sm-10 center-info" id="info_principal"></div>
        </div>
        <div class="row" id="planTimeDiv">
          <label for="info_planTime" class="col-sm-2 no-padding-right">预计时间</label>
          <div class="col-sm-10 center-info" id="info_planTime"></div>
        </div>
        <div class="row">
          <label for="info_startTime" class="col-sm-2 no-padding-right">开始时间</label>
          <div class="col-sm-10 center-info" id="info_startTime"></div>
        </div>
        <div class="row">
          <label for="info_endTime" class="col-sm-2 no-padding-right">完成时间</label>
          <div class="col-sm-10 center-info" id="info_endTime"></div>
        </div>
        <div class="row">
          <label for="info_comment" class="col-sm-2 no-padding-right">备注</label>
          <div class="col-sm-10 center-info" id="info_comment"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-info btn-close" data-dismiss="modal">确定</button>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!--修改项目状态提示模态框-->
<div class="modal fade" id="modal-cause">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" th:text="|确定对${project.name}进行这种操作吗？|"></h4>
      </div>
      <div class="modal-body">

        <form id="cause" class="form-horizontal" role="form">
          <input type="hidden" name="id" th:value="${project.id}">
          <input type="hidden" name="status" id="cause_status">
          <div class="form-group">
            <label for="comment" class="col-sm-2 control-label no-padding-right">原因</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" name="comment" th:value="${project.comment}" placeholder="请输入原因" >
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">确定</button>
        <button type="button" class="btn btn-primary" id="btn-cause">确定</button>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!--互动专区模态框-->
<div class="modal fade" id="modal-receiver">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">互动专区</h4>
      </div>
      <div class="modal-body">
        <div class="box direct-chat direct-chat-primary">
          <div class="box-body" id="message-box-body">
            <div class="direct-chat-messages" id="message-box" style="height: 500px">
              <div class="direct-chat-msg" th:each="message:${project.messages}"
                   th:classappend="${message.user.id == session.user.id ? 'right':''}">
                <div class="direct-chat-info clearfix">
                  <span class="direct-chat-name"
                        th:classappend="${message.user.id == session.user.id ? 'pull-right':'pull-left'}"
                        th:text="${message.user.name}">Alexander Pierce</span>
                  <span class="direct-chat-timestamp"
                        th:classappend="${message.user.id == session.user.id ? 'pull-left':'pull-right'}"
                        th:text="${#dates.format(message.createTime,'yyyy-MM-dd HH:mm:ss')}"></span>
                </div>
                <img class="direct-chat-img" th:src="${#strings.isEmpty(message.user.img)}?@{/img/person.png}:${message.user.img}" alt="Message User Image">
                <div class="direct-chat-text" th:text="${message.content}"></div>
              </div>
            </div>
          </div>
          <div class="box-footer">
            <form method="post" id="messageForm">
              <div class="input-group">
                <input type="hidden" name="projectId" th:value="${project.id}">
                <input type="text" name="content" id="message" autocomplete="off" data-provide="typeahead" placeholder="请输入内容" class="form-control">
                <span class="input-group-btn">
                  <button type="button" class="btn btn-primary btn-flat" id="btn-send">发送</button>
                </span>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<section class="content-header">
  <button style="margin-right: 10px" th:if="${project.status == 2}" shiro:hasPermission="project:cancel" type="button" class="btn btn-danger pull-right" th:onclick="|updateStatus(${project.id}, 0, '${project.name}')|" >取消</button>
  <button style="margin-right: 10px" th:if="${project.status == 0}" shiro:hasPermission="project:regain" type="button" class="btn btn-success pull-right" th:onclick="|updateStatus(${project.id}, 2, '${project.name}')|" >恢复</button>
  <button style="margin-right: 10px" th:if="${project.status == 2}" shiro:hasPermission="project:pause" type="button" class="btn btn-danger pull-right" th:onclick="|updateStatus(${project.id}, 3, '${project.name}')|" >暂停</button>
  <button style="margin-right: 10px" th:if="${project.status == 3}" shiro:hasPermission="project:start" type="button" class="btn btn-success pull-right" th:onclick="|updateStatus(${project.id}, 2, '${project.name}')|" >启动</button>
  <a style="margin-right: 10px" shiro:hasPermission="project:update" class="btn btn-warning pull-right" th:href="@{'/project/update/'+${project.id}}">修改项目</a>
  <!--<button style="margin-right: 10px" shiro:hasPermission="message:create" type="button" class="btn btn-info pull-right" id="messageModal" >发送消息</button>-->
  <h1>
    单项目看板
    <small th:text="|${project.code}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${project.name}|"></small>
  </h1>
</section>
<!-- Main content -->
<section class="content">
  <div class="row" id="rowDiv">
    <div id="div1" class="col-md-2">
      <div class="box box-success box-solid">
        <div class="box-header with-border">
          <h3 class="box-title" th:text="${project.produceTasks[0].produceName}">任务单</h3>
          <small class="pull-right" th:if="${taskCount != 0}" th:text="|已上传：${taskCount}|"></small>
        </div>
        <div class="box-body" style="display: block;">
          <div>时间：<span th:text="${#dates.format(project.produceTasks[0].startTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <br>
          <br>
          <br>
          <br>
        </div>
        <div class="box-footer">
          <span>&nbsp;</span>
          <button style="margin-right: 5px" shiro:hasAnyPermissions="task:upload,task:download,task:del" class="btn btn-success btn-xs pull-right" th:onclick="|uploadModel(${project.id},'${project.code}', 1)|">文件</button>
        </div>
      </div>

      <div class="box box-info box-solid">
        <div class="box-header with-border">
          <h3 class="box-title">互动专区</h3>
        </div>
        <div class="box-body" style="display: block;">
          <div th:each="message,stat:${project.messages}" th:if="${stat.index < 5}">
            <span th:text="${message.user.name}"></span>：
            <span th:text="${#strings.abbreviate(message.content,10)}"></span>
          </div>
          <div th:if="${project.messages.size() < 5}" th:each="n : ${#numbers.sequence(1,5 - project.messages.size())}"><span>&nbsp;</span></div>
        </div>
        <div class="box-footer">
          <button style="margin-right: 5px" class="btn btn-info btn-xs pull-right" onclick="messageInfo()">查看</button>
        </div>
      </div>
    </div>
    <div id="div2" class="col-md-2">
      <div class="box box-solid" th:classappend="${project.produceTasks[1].status == 0 ? 'box-default' : (project.produceTasks[1].status == 1 ? 'box-warning' : 'box-success')}">
        <div class="box-header box- with-border">
          <h3 class="box-title" th:text="${project.produceTasks[1].produceName}" >技术协议</h3>
          <small class="pull-right" th:if="${signCount != 0}" th:text="|已上传：${signCount}|"></small>
        </div>
        <div class="box-body" style="display: block;">
          <div th:if="${project.produceTasks[1].startTime}">从<span th:text="${#dates.format(project.produceTasks[1].startTime,'yyyy-MM-dd')}">2018-08-01</span>到<span th:text="${#dates.format(project.produceTasks[1].endTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div th:unless="${project.produceTasks[1].startTime}">时间</div>
          <div th:if="${project.produceTasks[1].principal}">负责人：<span th:text="${#strings.abbreviate(project.produceTasks[1].principal,6)}">某某人</span></div>
          <div th:unless="${project.produceTasks[1].principal}">负责人：</div>
          <div>预计时间：<span th:text="${#dates.format(project.produceTasks[1].planStartTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div>状态：
            <span th:switch="${project.produceTasks[1].status}">
              <span th:case="0">未开始</span>
              <span th:case="1">执行中</span>
              <span th:case="2">已完成</span>
            </span>
          </div>
          <div>备注：<span th:text="${#strings.abbreviate(project.produceTasks[1].comment,10)}">无</span></div>
        </div>
        <div class="box-footer">
          <!--<button th:if="${project.status == 2 and project.produceTasks[1].status == 2}" shiro:hasPermission="sign:cancel" type="button" class="btn btn-danger btn-xs pull-right" th:onclick="|cancelSignContractTaskSchedule(${project.produceTasks[1].id})|" id="btn-cancel-sign">撤消</button>-->
          <button th:if="${project.status == 2}" shiro:hasPermission="sign:edit" style="margin-right: 5px" class="btn btn-warning btn-xs pull-right" th:onclick="|editProduceTask(${project.produceTasks[1].id},'${project.name}','${project.produceTasks[1].produceName}',${project.produceTasks[1].status},'${project.produceTasks[1].principal}','${#dates.format(project.produceTasks[1].planStartTime,'yyyy-MM-dd')}','${project.produceTasks[1].comment}')|">编辑任务</button>
          <button style="margin-right: 5px" shiro:hasAnyPermissions="sign:upload,sign:download,sign:del" class="btn btn-success btn-xs pull-right" th:onclick="|uploadModel(${project.id},'${project.code}', 2)|">文件</button>
          <button style="margin-right: 5px" class="btn btn-info btn-xs pull-right" th:onclick="|info('${project.name}','${project.produceTasks[1].produceName}',${project.produceTasks[1].status},'${project.produceTasks[1].principal}','${#dates.format(project.produceTasks[1].planStartTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[1].startTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[1].endTime,'yyyy-MM-dd')}','${project.produceTasks[1].comment}')|">查看</button>
        </div>
      </div>



      <div class="box box-solid" th:classappend="${project.produceTasks[2].status == 0 ? 'box-default' : (project.produceTasks[2].status == 1 ? 'box-warning' :'box-success')}">
        <div class="box-header with-border">
          <h3 class="box-title" th:text="${project.produceTasks[2].produceName}" >合同</h3>
          <small class="pull-right" th:if="${contractCount != 0}" th:text="|已上传：${contractCount}|"></small>
        </div>
        <div class="box-body" style="display: block;">
          <div th:if="${project.produceTasks[2].startTime}">从<span th:text="${#dates.format(project.produceTasks[2].startTime,'yyyy-MM-dd')}">2018-08-01</span>到<span th:text="${#dates.format(project.produceTasks[2].endTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div th:unless="${project.produceTasks[2].startTime}">时间</div>
          <div th:if="${project.produceTasks[2].principal}">负责人：<span th:text="${#strings.abbreviate(project.produceTasks[2].principal,6)}">某某人</span></div>
          <div th:unless="${project.produceTasks[2].principal}">负责人：</div>
          <div th:if="${project.produceTasks[2].contractNo}">合同号：<span th:text="${#strings.abbreviate(project.produceTasks[2].contractNo,10)}">合同号</span></div>
          <div th:unless="${project.produceTasks[2].contractNo}">合同号：</div>
          <div>状态：
            <span th:switch="${project.produceTasks[2].status}">
              <span th:case="0">未开始</span>
              <span th:case="1">执行中</span>
              <span th:case="2">已完成</span>
            </span>
          </div>
          <div>备注：<span th:text="${#strings.abbreviate(project.produceTasks[2].comment,10)}">无</span></div>
        </div>
        <div class="box-footer">
          <!--<button th:if="${project.status == 2 and project.produceTasks[2].status == 2}" shiro:hasPermission="contract:cancel" type="button" class="btn btn-danger btn-xs pull-right" th:onclick="|cancelSignContractTaskSchedule(${project.produceTasks[2].id})|" id="btn-cancel-contract">撤消</button>-->
          <button th:if="${project.status == 2}" shiro:hasPermission="contract:edit" style="margin-right: 5px" class="btn btn-warning btn-xs pull-right" th:onclick="|editProduceTask(${project.produceTasks[2].id},'${project.name}','${project.produceTasks[2].produceName}',${project.produceTasks[2].status},'${project.produceTasks[2].principal}','${#dates.format(project.produceTasks[2].planStartTime,'yyyy-MM-dd')}','${project.produceTasks[2].comment}','${project.produceTasks[2].contractNo}')|">编辑任务</button>
          <button style="margin-right: 5px" shiro:hasAnyPermissions="contract:upload,contract:download,contract:del" class="btn btn-success btn-xs pull-right" th:onclick="|uploadModel(${project.id},'${project.code}', 3)|">文件</button>
          <button style="margin-right: 5px" class="btn btn-info btn-xs pull-right" th:onclick="|info('${project.name}','${project.produceTasks[2].produceName}',${project.produceTasks[2].status},'${project.produceTasks[2].principal}','${#dates.format(project.produceTasks[2].planStartTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[2].startTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[2].endTime,'yyyy-MM-dd')}','${project.produceTasks[2].comment}','${project.produceTasks[2].contractNo}')|">查看</button>
        </div>
      </div>

    </div>
    <div id="div3" class="col-md-8">
      <div class="row">
        <div class="col-lg-3" th:each="task: ${project.deptTasks}">
          <div class="box box-solid" th:classappend="${task.status == 0 ? 'box-default' : (task.status == 1 ? 'box-warning' : (task.status == 2 ? 'box-success' : 'box-danger'))}">
            <div class="box-header with-border">
              <h3 class="box-title" th:text="${task.stepName}"></h3>
              <!--<b class="pull-right" th:text="${task.stepNum}"></b>-->
            </div>
            <div class="box-body" style="display: block;">
              <div th:if="${task.startTime}">从<span th:text="${#dates.format(task.startTime,'yyyy-MM-dd')}">2018-08-01</span>到<span th:text="${#dates.format(task.endTime,'yyyy-MM-dd')}">2018-08-01</span></div>
              <div th:unless="${task.startTime}">时间</div>
              <div th:if="${task.principal}">负责人：<span th:text="${#strings.abbreviate(task.principal,10)}">某某人</span></div>
              <div th:unless="${task.principal}">负责人：</div>
              <div>预计时间：<span th:text="${#dates.format(task.planStartTime,'yyyy-MM-dd')}">2018-08-01</span></div>
              <div>状态：
                <span th:switch="${task.status}">
                  <span th:case="0">未开始</span>
                  <span th:case="1">执行中</span>
                  <span th:case="2">已完成</span>
                </span>
              </div>
              <div>备注：<span th:text="${#strings.abbreviate(task.comment,10)}">无</span></div>
            </div>
            <div class="box-footer">
              <button th:if="${project.status == 2}" shiro:hasRole="${task.name}" style="margin-right: 5px" class="btn btn-warning btn-xs pull-right" th:onclick="|editDeptTask(${task.id},'${project.name}','${task.stepName}',${task.departmentType},${task.departmentNum},${task.status},'${task.principal}','${#dates.format(task.planStartTime,'yyyy-MM-dd')}','${task.comment}')|">编辑任务</button>
              <button style="margin-right: 5px" class="btn btn-info btn-xs pull-right" th:onclick="|info('${project.name}','${task.stepName}',${task.status},'${task.principal}','${#dates.format(task.planStartTime,'yyyy-MM-dd')}','${#dates.format(task.startTime,'yyyy-MM-dd')}','${#dates.format(task.endTime,'yyyy-MM-dd')}','${task.comment}')|">查看</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div style="height: 3px; background-color: #1a2226; margin: 10px auto 30px 0;"></div>
  <div class="row">
    <div class="col-md-2 col-md-offset-2">
      <div class="box box-solid" th:classappend="${project.produceTasks[3].status == 0 ? 'box-default' : (project.produceTasks[3].status == 1 ? 'box-warning' : 'box-success')}">
        <div class="box-header with-border">
          <h3 class="box-title" th:text="${project.produceTasks[3].produceName}" >原材料外协计划</h3>
        </div>
        <div class="box-body" style="display: block;">
          <div th:if="${project.produceTasks[3].startTime}">从<span th:text="${#dates.format(project.produceTasks[3].startTime,'yyyy-MM-dd')}">3018-08-01</span>到<span th:text="${#dates.format(project.produceTasks[3].endTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div th:unless="${project.produceTasks[3].startTime}">时间</div>
          <div th:if="${project.produceTasks[3].principal}">负责人：<span th:text="${#strings.abbreviate(project.produceTasks[3].principal,10)}">某某人</span></div>
          <div th:unless="${project.produceTasks[3].principal}">负责人：</div>
          <div>预计时间：<span th:text="${#dates.format(project.produceTasks[3].planStartTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div>状态：
            <span th:switch="${project.produceTasks[3].status}">
              <span th:case="0">未开始</span>
              <span th:case="1">执行中</span>
              <span th:case="2">已完成</span>
            </span>
          </div>
          <div>备注：<span th:text="${#strings.abbreviate(project.produceTasks[3].comment,10)}">无</span></div>
        </div>
        <div class="box-footer">
          <button th:if="${project.status == 2}" shiro:hasPermission="process1:edit" style="margin-right: 5px" class="btn btn-warning btn-xs pull-right" th:onclick="|editProduceTask(${project.produceTasks[3].id},'${project.name}','${project.produceTasks[3].produceName}',${project.produceTasks[3].status},'${project.produceTasks[3].principal}','${#dates.format(project.produceTasks[3].planStartTime,'yyyy-MM-dd')}','${project.produceTasks[3].comment}')|">编辑任务</button>
          <button style="margin-right: 5px" class="btn btn-info btn-xs pull-right" th:onclick="|info('${project.name}','${project.produceTasks[3].produceName}',${project.produceTasks[3].status},'${project.produceTasks[3].principal}','${#dates.format(project.produceTasks[3].planStartTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[3].startTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[3].endTime,'yyyy-MM-dd')}','${project.produceTasks[3].comment}')|">查看</button>
        </div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="box box-solid" th:classappend="${project.produceTasks[6].status == 0 ? 'box-default' : (project.produceTasks[6].status == 1 ? 'box-warning' : 'box-success')}">
        <div class="box-header with-border">
          <h3 class="box-title" th:text="${project.produceTasks[6].produceName}" >技术协议</h3>
        </div>
        <div class="box-body" style="display: block;">
          <div th:if="${project.produceTasks[6].startTime}">从<span th:text="${#dates.format(project.produceTasks[6].startTime,'yyyy-MM-dd')}">2018-08-01</span>到<span th:text="${#dates.format(project.produceTasks[6].endTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div th:unless="${project.produceTasks[6].startTime}">时间</div>
          <div th:if="${project.produceTasks[6].principal}">负责人：<span th:text="${#strings.abbreviate(project.produceTasks[6].principal,10)}">某某人</span></div>
          <div th:unless="${project.produceTasks[6].principal}">负责人：</div>
          <div>预计时间：<span th:text="${#dates.format(project.produceTasks[6].planStartTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div>状态：
            <span th:switch="${project.produceTasks[6].status}">
              <span th:case="0">未开始</span>
              <span th:case="1">执行中</span>
              <span th:case="2">已完成</span>
            </span>
          </div>
          <div>备注：<span th:text="${#strings.abbreviate(project.produceTasks[6].comment,10)}">无</span></div>
        </div>
        <div class="box-footer">
          <button th:if="${project.status == 2}" shiro:hasPermission="produce1:edit" style="margin-right: 5px" class="btn btn-warning btn-xs pull-right" th:onclick="|editProduceTask(${project.produceTasks[6].id},'${project.name}','${project.produceTasks[6].produceName}',${project.produceTasks[6].status},'${project.produceTasks[6].principal}','${#dates.format(project.produceTasks[6].planStartTime,'yyyy-MM-dd')}','${project.produceTasks[6].comment}')|">编辑任务</button>
          <button style="margin-right: 5px" class="btn btn-info btn-xs pull-right" th:onclick="|info('${project.name}','${project.produceTasks[6].produceName}',${project.produceTasks[6].status},'${project.produceTasks[6].principal}','${#dates.format(project.produceTasks[6].planStartTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[6].startTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[6].endTime,'yyyy-MM-dd')}','${project.produceTasks[6].comment}')|">查看</button>
        </div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="box box-solid" th:classappend="${project.produceTasks[9].status == 0 ? 'box-default' : (project.produceTasks[9].status == 1 ? 'box-warning' : 'box-success')}">
        <div class="box-header with-border">
          <h3 class="box-title" th:text="${project.produceTasks[9].produceName}" >技术协议</h3>
        </div>
        <div class="box-body" style="display: block;">
          <div th:if="${project.produceTasks[9].startTime}">从<span th:text="${#dates.format(project.produceTasks[9].startTime,'yyyy-MM-dd')}">2018-08-01</span>到<span th:text="${#dates.format(project.produceTasks[9].endTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div th:unless="${project.produceTasks[9].startTime}">时间</div>
          <div th:if="${project.produceTasks[9].principal}">负责人：<span th:text="${#strings.abbreviate(project.produceTasks[9].principal,10)}">某某人</span></div>
          <div th:unless="${project.produceTasks[9].principal}">负责人：</div>
          <div>预计时间：<span th:text="${#dates.format(project.produceTasks[9].planStartTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div>状态：
            <span th:switch="${project.produceTasks[9].status}">
              <span th:case="0">未开始</span>
              <span th:case="1">执行中</span>
              <span th:case="2">已完成</span>
            </span>
          </div>
          <div>备注：<span th:text="${#strings.abbreviate(project.produceTasks[9].comment,10)}">无</span></div>
        </div>
        <div class="box-footer">
          <button th:if="${project.status == 2}" shiro:hasPermission="debug:edit" style="margin-right: 5px" class="btn btn-warning btn-xs pull-right" th:onclick="|editProduceTask(${project.produceTasks[9].id},'${project.name}','${project.produceTasks[9].produceName}',${project.produceTasks[9].status},'${project.produceTasks[9].principal}','${#dates.format(project.produceTasks[9].planStartTime,'yyyy-MM-dd')}','${project.produceTasks[9].comment}')|">编辑任务</button>
          <button style="margin-right: 5px" class="btn btn-info btn-xs pull-right" th:onclick="|info('${project.name}','${project.produceTasks[9].produceName}',${project.produceTasks[9].status},'${project.produceTasks[9].principal}','${#dates.format(project.produceTasks[9].planStartTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[9].startTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[9].endTime,'yyyy-MM-dd')}','${project.produceTasks[9].comment}')|">查看</button>
        </div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="box box-solid" th:classappend="${project.produceTasks[10].status == 0 ? 'box-default' : (project.produceTasks[10].status == 1 ? 'box-warning' : 'box-success')}">
        <div class="box-header with-border">
          <h3 class="box-title" th:text="${project.produceTasks[10].produceName}" >技术协议</h3>
        </div>
        <div class="box-body" style="display: block;">
          <div th:if="${project.produceTasks[10].startTime}">从<span th:text="${#dates.format(project.produceTasks[10].startTime,'yyyy-MM-dd')}">2018-08-01</span>到<span th:text="${#dates.format(project.produceTasks[10].endTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div th:unless="${project.produceTasks[10].startTime}">时间</div>
          <div th:if="${project.produceTasks[10].principal}">负责人：<span th:text="${#strings.abbreviate(project.produceTasks[10].principal,10)}">某某人</span></div>
          <div th:unless="${project.produceTasks[10].principal}">负责人：</div>
          <div>预计时间：<span th:text="${#dates.format(project.produceTasks[10].planStartTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div>状态：
            <span th:switch="${project.produceTasks[10].status}">
              <span th:case="0">未开始</span>
              <span th:case="1">执行中</span>
              <span th:case="2">已完成</span>
            </span>
          </div>
          <div>备注：<span th:text="${#strings.abbreviate(project.produceTasks[10].comment,10)}">无</span></div>
        </div>
        <div class="box-footer">
          <button th:if="${project.status == 2}" shiro:hasPermission="accept:edit" style="margin-right: 10px" class="btn btn-warning btn-xs pull-right" th:onclick="|editProduceTask(${project.produceTasks[10].id},'${project.name}','${project.produceTasks[10].produceName}',${project.produceTasks[10].status},'${project.produceTasks[10].principal}','${#dates.format(project.produceTasks[10].planStartTime,'yyyy-MM-dd')}','${project.produceTasks[10].comment}')|">编辑任务</button>
          <button style="margin-right: 5px" class="btn btn-info btn-xs pull-right" th:onclick="|info('${project.name}','${project.produceTasks[10].produceName}',${project.produceTasks[10].status},'${project.produceTasks[10].principal}','${#dates.format(project.produceTasks[10].planStartTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[10].startTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[10].endTime,'yyyy-MM-dd')}','${project.produceTasks[10].comment}')|">查看</button>
        </div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="box box-solid" th:classappend="${project.produceTasks[11].status == 0 ? 'box-default' : (project.produceTasks[11].status == 1 ? 'box-warning' : 'box-success')}">
        <div class="box-header with-border">
          <h3 class="box-title" th:text="${project.produceTasks[11].produceName}" >技术协议</h3>
        </div>
        <div class="box-body" style="display: block;">
          <div th:if="${project.produceTasks[11].startTime}">从<span th:text="${#dates.format(project.produceTasks[11].startTime,'yyyy-MM-dd')}">2018-08-01</span>到<span th:text="${#dates.format(project.produceTasks[11].endTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div th:unless="${project.produceTasks[11].startTime}">时间</div>
          <div th:if="${project.produceTasks[11].principal}">负责人：<span th:text="${#strings.abbreviate(project.produceTasks[11].principal,10)}">某某人</span></div>
          <div th:unless="${project.produceTasks[11].principal}">负责人：</div>
          <div>预计时间：<span th:text="${#dates.format(project.produceTasks[11].planStartTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div>状态：
            <span th:switch="${project.produceTasks[11].status}">
              <span th:case="0">未开始</span>
              <span th:case="1">执行中</span>
              <span th:case="2">已完成</span>
            </span>
          </div>
          <div>备注：<span th:text="${#strings.abbreviate(project.produceTasks[11].comment,10)}">无</span></div>
        </div>
        <div class="box-footer">
          <button th:if="${project.status == 2 or project.status == 4}" shiro:hasPermission="save:edit" style="margin-right: 6px" class="btn btn-warning btn-xs pull-right" th:onclick="|editProduceTask(${project.produceTasks[11].id},'${project.name}','${project.produceTasks[11].produceName}',${project.produceTasks[11].status},'${project.produceTasks[11].principal}','${#dates.format(project.produceTasks[11].planStartTime,'yyyy-MM-dd')}','${project.produceTasks[11].comment}')|">编辑任务</button>
          <button style="margin-right: 6px" class="btn btn-info btn-xs pull-right" th:onclick="|info('${project.name}','${project.produceTasks[11].produceName}',${project.produceTasks[11].status},'${project.produceTasks[11].principal}','${#dates.format(project.produceTasks[11].planStartTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[11].startTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[11].endTime,'yyyy-MM-dd')}','${project.produceTasks[11].comment}')|">查看</button>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-2 col-md-offset-2">
      <div class="box box-solid" th:classappend="${project.produceTasks[4].status == 0 ? 'box-default' : (project.produceTasks[4].status == 1 ? 'box-warning' : 'box-success')}">
        <div class="box-header with-border">
          <h3 class="box-title" th:text="${project.produceTasks[4].produceName}" >生产制造</h3>
        </div>
        <div class="box-body" style="display: block;">
          <div th:if="${project.produceTasks[4].startTime}">从<span th:text="${#dates.format(project.produceTasks[4].startTime,'yyyy-MM-dd')}">2018-08-01</span>到<span th:text="${#dates.format(project.produceTasks[4].endTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div th:unless="${project.produceTasks[4].startTime}">时间</div>
          <div th:if="${project.produceTasks[4].principal}">负责人：<span th:text="${#strings.abbreviate(project.produceTasks[4].principal,10)}">某某人</span></div>
          <div th:unless="${project.produceTasks[4].principal}">负责人：</div>
          <div>预计时间：<span th:text="${#dates.format(project.produceTasks[4].planStartTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div>状态：
            <span th:switch="${project.produceTasks[4].status}">
              <span th:case="0">未开始</span>
              <span th:case="1">执行中</span>
              <span th:case="2">已完成</span>
            </span>
          </div>
          <div>备注：<span th:text="${#strings.abbreviate(project.produceTasks[4].comment,10)}">无</span></div>
        </div>
        <div class="box-footer">
          <button th:if="${project.status == 2}" shiro:hasPermission="process2:edit" style="margin-right: 5px" class="btn btn-warning btn-xs pull-right" th:onclick="|editProduceTask(${project.produceTasks[4].id},'${project.name}','${project.produceTasks[4].produceName}',${project.produceTasks[4].status},'${project.produceTasks[4].principal}','${#dates.format(project.produceTasks[4].planStartTime,'yyyy-MM-dd')}','${project.produceTasks[4].comment}')|">编辑任务</button>
          <button style="margin-right: 5px" class="btn btn-info btn-xs pull-right" th:onclick="|info('${project.name}','${project.produceTasks[4].produceName}',${project.produceTasks[4].status},'${project.produceTasks[4].principal}','${#dates.format(project.produceTasks[4].planStartTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[4].startTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[4].endTime,'yyyy-MM-dd')}','${project.produceTasks[4].comment}')|">查看</button>
        </div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="box box-solid" th:classappend="${project.produceTasks[7].status == 0 ? 'box-default' : (project.produceTasks[7].status == 1 ? 'box-warning' : 'box-success')}">
        <div class="box-header with-border">
          <h3 class="box-title" th:text="${project.produceTasks[7].produceName}" >技术协议</h3>
        </div>
        <div class="box-body" style="display: block;">
          <div th:if="${project.produceTasks[7].startTime}">从<span th:text="${#dates.format(project.produceTasks[7].startTime,'yyyy-MM-dd')}">2018-08-01</span>到<span th:text="${#dates.format(project.produceTasks[7].endTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div th:unless="${project.produceTasks[7].startTime}">时间</div>
          <div th:if="${project.produceTasks[7].principal}">负责人：<span th:text="${#strings.abbreviate(project.produceTasks[7].principal,10)}">某某人</span></div>
          <div th:unless="${project.produceTasks[7].principal}">负责人：</div>
          <div>预计时间：<span th:text="${#dates.format(project.produceTasks[7].planStartTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div>状态：
            <span th:switch="${project.produceTasks[7].status}">
              <span th:case="0">未开始</span>
              <span th:case="1">执行中</span>
              <span th:case="2">已完成</span>
            </span>
          </div>
          <div>备注：<span th:text="${#strings.abbreviate(project.produceTasks[7].comment,10)}">无</span></div>
        </div>
        <div class="box-footer">
          <button th:if="${project.status == 2}" shiro:hasPermission="produce2:edit" style="margin-right: 5px" class="btn btn-warning btn-xs pull-right" th:onclick="|editProduceTask(${project.produceTasks[7].id},'${project.name}','${project.produceTasks[7].produceName}',${project.produceTasks[7].status},'${project.produceTasks[7].principal}','${#dates.format(project.produceTasks[7].planStartTime,'yyyy-MM-dd')}','${project.produceTasks[7].comment}')|">编辑任务</button>
          <button style="margin-right: 5px" class="btn btn-info btn-xs pull-right" th:onclick="|info('${project.name}','${project.produceTasks[7].produceName}',${project.produceTasks[7].status},'${project.produceTasks[7].principal}','${#dates.format(project.produceTasks[7].planStartTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[7].startTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[7].endTime,'yyyy-MM-dd')}','${project.produceTasks[7].comment}')|">查看</button>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-2 col-md-offset-2">
      <div class="box box-solid" th:classappend="${project.produceTasks[5].status == 0 ? 'box-default' : (project.produceTasks[5].status == 1 ? 'box-warning' : 'box-success')}">
        <div class="box-header with-border">
          <h3 class="box-title" th:text="${project.produceTasks[5].produceName}" >生产制造</h3>
        </div>
        <div class="box-body" style="display: block;">
          <div th:if="${project.produceTasks[5].startTime}">从<span th:text="${#dates.format(project.produceTasks[5].startTime,'yyyy-MM-dd')}">2018-08-01</span>到<span th:text="${#dates.format(project.produceTasks[5].endTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div th:unless="${project.produceTasks[5].startTime}">时间</div>
          <div th:if="${project.produceTasks[5].principal}">负责人：<span th:text="${#strings.abbreviate(project.produceTasks[5].principal,10)}">某某人</span></div>
          <div th:unless="${project.produceTasks[5].principal}">负责人：</div>
          <div>预计时间：<span th:text="${#dates.format(project.produceTasks[5].planStartTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div>状态：
            <span th:switch="${project.produceTasks[5].status}">
              <span th:case="0">未开始</span>
              <span th:case="1">执行中</span>
              <span th:case="2">已完成</span>
            </span>
          </div>
          <div>备注：<span th:text="${#strings.abbreviate(project.produceTasks[5].comment,10)}">无</span></div>
        </div>
        <div class="box-footer">
          <button th:if="${project.status == 2}" shiro:hasPermission="process3:edit" style="margin-right: 5px" class="btn btn-warning btn-xs pull-right" th:onclick="|editProduceTask(${project.produceTasks[5].id},'${project.name}','${project.produceTasks[5].produceName}',${project.produceTasks[5].status},'${project.produceTasks[5].principal}','${#dates.format(project.produceTasks[5].planStartTime,'yyyy-MM-dd')}','${project.produceTasks[5].comment}')|">编辑任务</button>
          <button style="margin-right: 5px" class="btn btn-info btn-xs pull-right" th:onclick="|info('${project.name}','${project.produceTasks[5].produceName}',${project.produceTasks[5].status},'${project.produceTasks[5].principal}','${#dates.format(project.produceTasks[5].planStartTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[5].startTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[5].endTime,'yyyy-MM-dd')}','${project.produceTasks[5].comment}')|">查看</button>
        </div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="box box-solid" th:classappend="${project.produceTasks[8].status == 0 ? 'box-default' : (project.produceTasks[8].status == 1 ? 'box-warning' : 'box-success')}">
        <div class="box-header with-border">
          <h3 class="box-title" th:text="${project.produceTasks[8].produceName}" >技术协议</h3>
        </div>
        <div class="box-body" style="display: block;">
          <div th:if="${project.produceTasks[8].startTime}">从<span th:text="${#dates.format(project.produceTasks[8].startTime,'yyyy-MM-dd')}">2018-08-01</span>到<span th:text="${#dates.format(project.produceTasks[8].endTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div th:unless="${project.produceTasks[8].startTime}">时间</div>
          <div th:if="${project.produceTasks[8].principal}">负责人：<span th:text="${#strings.abbreviate(project.produceTasks[8].principal,10)}">某某人</span></div>
          <div th:unless="${project.produceTasks[8].principal}">负责人：</div>
          <div>预计时间：<span th:text="${#dates.format(project.produceTasks[8].planStartTime,'yyyy-MM-dd')}">2018-08-01</span></div>
          <div>状态：
            <span th:switch="${project.produceTasks[8].status}">
              <span th:case="0">未开始</span>
              <span th:case="1">执行中</span>
              <span th:case="2">已完成</span>
            </span>
          </div>
          <div>备注：<span th:text="${#strings.abbreviate(project.produceTasks[8].comment,10)}">无</span></div>
        </div>
        <div class="box-footer">
          <button th:if="${project.status == 2}" shiro:hasPermission="produce3:edit" style="margin-right: 5px" class="btn btn-warning btn-xs pull-right" th:onclick="|editProduceTask(${project.produceTasks[8].id},'${project.name}','${project.produceTasks[8].produceName}',${project.produceTasks[8].status},'${project.produceTasks[8].principal}','${#dates.format(project.produceTasks[8].planStartTime,'yyyy-MM-dd')}','${project.produceTasks[8].comment}')|">编辑任务</button>
          <button style="margin-right: 5px" class="btn btn-info btn-xs pull-right" th:onclick="|info('${project.name}','${project.produceTasks[8].produceName}',${project.produceTasks[8].status},'${project.produceTasks[8].principal}','${#dates.format(project.produceTasks[8].planStartTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[8].startTime,'yyyy-MM-dd')}','${#dates.format(project.produceTasks[8].endTime,'yyyy-MM-dd')}','${project.produceTasks[8].comment}')|">查看</button>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- /.content -->
<div th:include="include :: footer"></div>
<script th:inline="javascript">

  var deptName = ["","机械设计","液压设计","电气设计","软件设计"];
  var deptNum = ["","一科","二科","三科","四科","五科","六科","七科","八科"];
  var statusName = ["未开始","执行中","已完成"];
  var taskForm = $("#taskForm");
  var uploadForm = $("#uploadForm");
  var downhref = [[@{/project/download}]] + "?code=" + [[${project.code}]];


  /** 显示设计任务模态框 */
  function editDeptTask(id, projectName, stepName, deptType, deptNo, status, principal, planTime, comment) {
    $(".btn-cancel-task").hide(); // 隐藏所有生产撤消按钮
    $("#btn-commit").show(); // 显示设计开始/完成按钮
    $("#btn-comment").show(); // 显示设计确定按钮
    $("#successStatus").hide(); // 隐藏完成状态
    $("#btn-cancel").hide(); // 隐藏设计撤消按钮
    $("#btn-commit-produce").hide(); // 隐藏生产开始/完成按钮
    $("#btn-comment-produce").hide(); // 隐藏生产确定按钮
    // 表单赋值
    $("#id").val(id);
    $("#projectName").val(projectName);
    $("#stepName").val(deptName[deptType] + deptNum[deptNo] + "----" + stepName);
    $("#principal").val(principal != 'null' ? principal : '');
    $("#planStartTime").val(planTime != 'null' ? planTime : '');
    $("#comment").val(comment != 'null' ? comment : '');
    if (status == 0) {
      $("#status").val(1);
      $("#btn-commit").text("开始");
    } else if (status == 1) {
      $("#status").val(2);
      $("#btn-commit").text("完成");
      $("#btn-cancel").show();
    } else {
      $("#btn-commit").hide();
      $("#successStatus").show();
      $("#btn-cancel").show();
    }
    $("#contractDiv").hide(); // 设计隐藏签合同
    $("#planStartTimeDiv").show(); // 设计显示计划时间
    $('#modal-task').modal('show');
  }
  /** 提交设计部任务进度 */
  function deptTaskSchedule() {
    $.ajax({
      url: "/project/task/dept/edit",
      type: "POST",
      data: taskForm.serialize(),
      success: function (result) {
        if (result.status === 200) {
          location.reload();
        }
      },
      error: function () {
        toastr.success("编辑失败！");
      }
    });
  }
  /** 提交设计部任务信息 */
  function editDeptTaskInfo() {
    $.ajax({
      url: "/project/task/dept/edit",
      type: "POST",
      data: {
        id: $("#id").val(),
        principal: $("#principal").val(),
        planStartTime: $("#planStartTime").val(),
        comment: $("#comment").val()
      },
      success: function (result) {
        if (result.status === 200) {
          location.reload();
        }
      },
      error: function () {
        toastr.success("编辑失败！");
      }
    });
  }
  /** 撤消设计任务完成状态 */
  function cancelDeptTaskSchedule() {
    $.ajax({
      url: "/project/dept/cancel",
      type: "POST",
      data: {
        id: $("#id").val()
      },
      success: function (result) {
        if (result.status === 200) {
          location.reload();
        }
      },
      error: function () {
        toastr.success("编辑失败！");
      }
    });
  }

  /** 显示生产部任务模态框 */
  function editProduceTask(id, projectName, stepName, status, principal, planTime, comment, contractNo) {
    $(".btn-cancel-task").hide(); // 隐藏所有生产撤消按钮
    $("#btn-commit").hide(); // 隐藏设计开始/完成按钮
    $("#btn-comment").hide(); // 隐藏设计确定按钮
    $("#successStatus").hide(); // 隐藏完成状态
    $("#btn-cancel").hide(); // 隐藏设计撤消按钮
    $("#btn-commit-produce").show(); // 显示生产开始/完成按钮
    $("#btn-comment-produce").show(); // 显示生产确定按钮
    // 表单赋值
    $("#id").val(id);
    $("#projectName").val(projectName);
    $("#stepName").val(stepName);
    $("#principal").val(principal != 'null' ? principal : '');
    $("#planStartTime").val(planTime != 'null' ? planTime : '');
    $("#comment").val(comment != 'null' ? comment : '');
    // 签合同显示合同号， 其它显示计划时间
    if (contractNo != undefined) {
      $("#contractNo").val(contractNo != 'null' ? contractNo : '');
      $("#contractDiv").show();
      $("#planStartTimeDiv").hide();
    } else {
      $("#contractDiv").hide();
      $("#planStartTimeDiv").show();
    }
    if (status == 0) {
      $("#status").val(1);
      $("#btn-commit-produce").text("开始");
      if (stepName == '技术协议') {
        $("#status").val(2);
        $("#btn-commit-produce").text("完成");
      }
    } else {
      switch (stepName) {
        case '技术协议':
          $("#btn-cancel-sign").show();
          break;
        case '合同':
          $("#btn-cancel-contract").show();
          break;
        case '原材料外协计划':
          $("#btn-cancel-process1").show();
          break;
        case '工艺编制':
          $("#btn-cancel-process2").show();
          break;
        case '外购计划':
          $("#btn-cancel-process3").show();
          break;
        case '铆焊制作':
          $("#btn-cancel-produce1").show();
          break;
        case '机加外协装配':
          $("#btn-cancel-produce2").show();
          break;
        case '现场安装':
          $("#btn-cancel-produce3").show();
          break;
        case '调试运行':
          $("#btn-cancel-debug").show();
          break;
        case '验收':
          $("#btn-cancel-accept").show();
          break;
        case '图纸存档':
          $("#btn-cancel-save").show();
          break;
      }
      if (status == 1) {
        $("#status").val(2);
        $("#btn-commit-produce").text("完成");
      } else {
        $("#btn-commit-produce").hide();
        $("#successStatus").show();
      }
    }

    $('#modal-task').modal('show');
  }
  /** 提交生产部任务进度 */
  function produceTaskSchedule() {
    $.ajax({
      url: "/project/task/produce/edit",
      type: "POST",
      data: $("#taskForm").serialize(),
      success: function (result) {
        if (result.status === 200) {
          location.reload();
        }
      },
      error: function () {
        toastr.success("编辑失败！");
      }
    });
  }
  /** 提交生产部任务信息 */
  function editProduceTaskInfo() {
    $.ajax({
      url: "/project/task/produce/edit",
      type: "POST",
      data: {
        id: $("#id").val(),
        principal: $("#principal").val(),
        planStartTime: $("#planStartTime").val(),
        comment: $("#comment").val(),
        contractNo: $("#contractNo").val()
      },
      success: function (result) {
        if (result.status === 200) {
          location.reload();
        }
      },
      error: function () {
        toastr.success("编辑失败！");
      }
    });
  }
  /** 撤消生产任务完成状态 */
  function cancelProduceTaskSchedule() {
    $.ajax({
      url: "/project/produce/cancel",
      type: "POST",
      data: {
        id: $("#id").val()
      },
      success: function (result) {
        if (result.status === 200) {
          location.reload();
        }
      },
      error: function () {
        toastr.success("编辑失败！");
      }
    });
  }

  /** 查看信息 */
  function info(projectName, taskName, status, principal, planTime, startTime, endTime, comment, contractNo) {
    $("#info_projectName").text(projectName);
    $("#info_task").text(taskName);
    $("#info_status").text(statusName[status]);
    $("#info_principal").text(principal != 'null' ? principal : '');
    $("#info_planTime").text(planTime != 'null' ? planTime : '');
    $("#info_startTime").text(startTime != 'null' ? startTime : '');
    $("#info_endTime").text(endTime != 'null' ? endTime : '');
    $("#info_comment").text(comment != 'null' ? comment : '');
    if (contractNo != undefined) {
      $("#contractInfoDiv").show();
      $("#info_contract").text(contractNo != 'null' ? contractNo : '');
      $("#planTimeDiv").hide();
    }
    else {
      $("#contractInfoDiv").hide();
      $("#planTimeDiv").show();
    }
    $("#modal-info").modal('show');
  }

  /** 修改项目㹜态提示模态框 */
  function updateStatus(id, status, name) {
    $("#cause_status").val(status);
    $('#modal-cause').modal('show');
  }

  /** 提交修改项目 */
  function pauseProject() {
    $.ajax({
      url: "/project/status",
      type: "POST",
      data: $("#cause").serialize(),
      success: function (result) {
        if (result.status === 200) {
          location.reload();
        }
      },
      error: function () {
        toastr.success("编辑失败！");
      }
    });
  }

  /** 上传模态框 */
  function uploadModel(id, code, type) {
    $("input:checkbox").prop("checked",false);
    $(".upload-btn").hide();
    $(".down-btn").hide();
    $(".remove-btn").hide();
    switch (type) {
      case 1:
        $("#taskGroup").show();
        $("#signGroup").hide();
        $("#contractGroup").hide();
        $("#btn-task-upload").show();
        $("#btn-task-download").show();
        $("#btn-task-del").show();
        break;
      case 2:
        $("#taskGroup").hide();
        $("#signGroup").show();
        $("#contractGroup").hide();
        $("#btn-sign-upload").show();
        $("#btn-sign-download").show();
        $("#btn-sign-del").show();
        break;
      case 3:
        $("#taskGroup").hide();
        $("#signGroup").hide();
        $("#contractGroup").show();
        $("#btn-contract-upload").show();
        $("#btn-contract-download").show();
        $("#btn-contract-del").show();
        break;
    }
    $("#upload_id").val(id);
    $("#upload_code").val(code);
    $("#upload_type").val(type);
    $('#modal-upload').modal('show');
  }

  /** 上传文件 */
  function uploadFile() {
    $("#uploadForm").ajaxSubmit({
      success: function (result) {
        if (result.status === 200) {
          location.reload();
        }
        else {
          toastr.success("上传失败！");
        }
      },
      error: function () {
        toastr.success("上传失败！");
      }
    })
  }

  /** 下载 */
  function delFile() {
    $("#uploadForm").ajaxSubmit({
      url: "/project/delFile",
      success: function (result) {
        if (result.status === 200) {
          location.reload();
        }
        else {
          toastr.success("删除失败！");
        }
      },
      error: function () {
        toastr.success("删除失败！");
      }
    })
  }

  /**  重置窗口大小居中对齐 */
  $(window).resize(function(){
    var hi = ($("#rowDiv").outerHeight() - $("#div1").outerHeight())/2;
    var hi2 = ($("#rowDiv").outerHeight() - $("#div2").outerHeight())/2;
    var hi3 = ($("#rowDiv").outerHeight() - $("#div3").outerHeight())/2;
    $("#div1").css("margin-top", hi);
    $("#div2").css("margin-top", hi2);
    $("#div3").css("margin-top", hi3);
  });

  /** 发送消息 */
  function sendMessage() {
    $.ajax({
      url: "/message/send",
      type: "POST",
      data: $("#messageForm").serialize(),
      success: function (result) {
        if (result.status === 200) {
          var img = /*[[@{/img/person.png}]]*/;

          if ([[${session.user.img}]] != null) {
            img = [[${session.user.img}]];
          }

          $("#message-box").append('<div class="direct-chat-msg right">' +
              '<div class="direct-chat-info clearfix">' +
              '<span class="direct-chat-name pull-right">' + [[${session.user.name}]] +
              '</span><span class="direct-chat-timestamp pull-left">' + new Date().format("yyyy-MM-dd hh:mm:ss") +
              '</span></div>' +
              '<img class="direct-chat-img" alt="Message User Image" src="' + img
              + '"><div class="direct-chat-text">' + $("#message").val() +
              '</div></div>');
          $("#message-box")[0].scrollTop = $("#message-box")[0].scrollHeight;
          $("#message").val('');
        }
      },
      error: function () {
        toastr.success("编辑失败！");
      }
    });
  }

  /** 显示互动专区模态框 */
  function messageInfo() {
    $("#modal-receiver").modal("show");
    $("#message-box")[0].scrollTop = $("#message-box")[0].scrollHeight;
  }

  $(function () {

    $(window).resize();

    /** 上传按钮 */
    $(".upload-btn").click(function(){
      uploadFile();
    });

    /** 下载按钮 */
    $(".down-btn").click(function () {
      if ($("input:checkbox:checked").length == 0) {
        toastr.success("请至少选择一个文件");
        return false;
      } else {
        var temp_href = downhref;
        $("input:checkbox:checked").each(function () {
          temp_href += "&ids=" + $(this).val();
        });
        $(".down-btn").attr("href",temp_href);
      }
    });

    /** 删除文件按钮 */
    $(".remove-btn").click(function () {
      if ($("input:checkbox:checked").length == 0) {
        toastr.success("请至少选择一个文件");
      } else {
        delFile();
      }
    });

    /** 提交设计任务进度按钮 */
    $("#btn-commit").click(function () {
      deptTaskSchedule();
    });
    /** 提交生产任务进度按钮 */
    $("#btn-commit-produce").click(function () {
      produceTaskSchedule();
    });
    /** 编辑设计任务信息按钮 */
    $("#btn-comment").click(function () {
      editDeptTaskInfo();
    });
    /** 编辑生产任务信息按钮 */
    $("#btn-comment-produce").click(function () {
      editProduceTaskInfo();
    });
    /** 撤消设计任务进度按钮 */
    $("#btn-cancel").click(function () {
      cancelDeptTaskSchedule();
    });
    /** 撤消生产任务进度按钮 */
    $(".btn-cancel-task").click(function () {
      cancelProduceTaskSchedule();
    });

    /** 提交暂停取消项目按钮 */
    $("#btn-cause").click(function () {
      pauseProject();
    });

    /** 提交消息按钮 */
    $("#btn-send").click(function () {
      sendMessage();
    });

    /** 日期控件加载， 并触发验证 */
    $('.datepicker').datepicker({
      format: 'yyyy-mm-dd',
      language: 'zh-cn',
      autoclose: true,
      clearBtn: true
    });

    /** 获取用户列表载入自动完成数据 */
    $.ajax({
      url: "/sys/user/list",
      type: "get",
      success: function (result) {
        if (result.status === 200) {
          $("#message").typeahead({
            items:10,
            source: result.content,
            matcher: function (item) {
              return ~item.name.indexOf(this.query.substring(this.query.lastIndexOf("@") + 1));
            },
            updater: function (item) {
              return  this.query.substring(0,this.query.lastIndexOf("@") + 1) + item.name + " ";
            },
            afterSelect: function () {
              window.document.getElementById("message").focus();
            }
          });
        }
      }
    });

    Date.prototype.format = function (format) {
      var args = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),  //quarter
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(format))
        format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      for (var i in args) {
        var n = args[i];
        if (new RegExp("(" + i + ")").test(format))
          format = format.replace(RegExp.$1, RegExp.$1.length == 1 ? n : ("00" + n).substr(("" + n).length));
      }
      return format;
    };

    window.parent.getReceiver();

  });
</script>
</body>
</html>
